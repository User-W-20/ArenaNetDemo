# ArenaNetDemo - UE4 C++ 多人网络对战演示

本项目是一个使用 C++ 实现的核心多人对战 Demo，专注于演示 Unreal Engine 中关键的网络同步机制、游戏流程管理和客户端 UI 触发逻辑。

## 🎯 项目亮点与核心功能

* **核心同步机制：** 利用 C++ 实现的 `PlayerState` 和 `GameState` 进行权威数据同步。
* **武器与换弹：** 实现了武器的 C++ 类，包括网络同步下的子弹消耗和**换弹 (Reload)** 逻辑。
* **胜利结算流程：** 游戏结束时，通过 **GameState 的 OnRep 机制** 可靠地触发所有客户端显示结算 UI。
* **UI 交互控制：** 实现了结算界面按钮功能，包括：
    * **重新开始 (Restart)**：通过控制台命令重新加载当前关卡。
    * **退出游戏 (Quit)**：通过控制台命令退出游戏会话。
* **角色重生：** 玩家死亡后，在服务器权威下进行销毁和重建，实现无缝重生。

## ⚙️ 技术栈与核心类

本项目主要使用 C++ 实现核心逻辑，并结合 UMG 蓝图（例如 `WBP_MatchResult`）进行 UI 搭建和数据配置。

| 类名                        | 作用         | 职责与网络角色                                               |
| :-------------------------- | :----------- | :----------------------------------------------------------- |
| `AArenaNetDemoGameModeBase` | 游戏主逻辑   | **Server Only**：处理比分累加、判断胜利条件（5杀）、触发重生。 |
| `AADemoCharacter`           | 玩家角色     | 包含武器装备、开火逻辑、**换弹输入绑定**。                   |
| `AADemoPlayerState`         | 玩家状态     | **Replicated**：保存击杀/死亡数据 (`Kills`, `Deaths`)，用于全网同步比分。 |
| `AADemoGameState`           | 比赛状态     | **Replicated**：保存比赛状态 (`CurrentMatchState`) 与赢家 (`WinningPlayerState`)，通过 **OnRep** 触发客户端 UI。 |
| `ADemoPlayerController`     | 客户端控制器 | **Client Only**：接收 `GameState` 事件绑定，在客户端创建并显示 `WBP_MatchResult` UI。 |
| `AWeapon`                   | 武器类       | 负责武器的生成、子弹消耗、**换弹同步**。                     |

## 🕹️ 游戏模式说明

1.  玩家进入游戏时，随机分配一把武器。
2.  玩家按下 **R 键** 触发换弹动作，换弹过程和子弹数在网络中同步。
3.  击杀敌方玩家可累积比分（`Kills`）。
4.  当任意玩家击杀数达到 **5 次** 时，游戏结束。
5.  客户端显示结算 UI，玩家可以通过按钮：
    * 点击 **重新开始** 按钮，使用 `RestartLevel` 命令重新加载地图，准备下一局。
    * 点击 **退出游戏** 按钮，退出当前游戏会话。

## 🚀 运行与测试指南 (如何测试多人联机)

为了验证多人联机和结算同步功能，请使用 Unreal Editor 的 **Play In Editor (PIE)** 模式启动两个或更多客户端。

### 步骤一：打开关卡

1.  在 Unreal Editor 顶部菜单栏，点击 **File (文件)**  -> **Open Level... (打开关卡...)**。
2.  导航到并选择你的地图文件：**`ArenaNetDemo`**。

### 步骤二：配置联机启动设置

1.  在 Unreal Editor 工具栏中，找到 **"Play"** 按钮旁边的 **下拉箭头**。
2.  选择 **"Multiplayer Options" (多人游戏选项)**。
3.  确保以下设置：
    * **Number of Players (玩家数量)：** 设置为 `2` 或更多。
    * **Net Mode (网络模式)：** 设置为 **`Listen Server` (监听服务器)**。

### 步骤三：启动联机会话并测试

1.  点击工具栏中的 **"Play"** 按钮。
2.  编辑器将启动多个窗口：一个作为 **监听服务器 (Listen Server)**，其他作为 **客户端 (Client)**。
3.  **测试功能：**
    * **换弹测试：** 在任一窗口中按下 **R 键**，观察子弹数和换弹动画是否在所有客户端中同步。
    * **结算测试：** 击杀对手直到击杀数达到 **5 次**。
    * **预期结果：** 所有窗口将同时显示 **`WBP_MatchResult` 结算 UI**。

